> 浏览器缓存机制是前端优化中非常重要的一环，它可以显著提升网页加载速度，减少服务器的压力。而协商缓存和强缓存是浏览器缓存中的两种主要方式，它们各有特点。

#### 强缓存

- 特点： 一旦资源被缓存，在有效期内，浏览器每次请求该资源时都会直接从缓存中获取，不会向服务器发送请求。
- 控制方式： 通过 HTTP 头部字段 `Cache-Control` 中的 `max-age` 指令来设置缓存的有效期。
- 优点： 减少了服务器的请求次数，提升了页面加载速度。
- 缺点： 如果服务器上的资源更新了，客户端在有效期内还是会使用旧的缓存资源，导致页面显示不一致。

#### 协商缓存

- 特点： 当强缓存失效后，浏览器会向服务器发送一个请求，请求中包含一个请求头（`If-Modified-Since` 或 `If-None-Match`），服务器会根据这个请求头来判断本地缓存是否过期，如果过期则返回新的资源，否则返回 `304 Not Modified` 状态码，告诉浏览器继续使用本地缓存。
- 控制方式： 通过 `HTTP` 头部字段 `Last-Modified` 或 `ETag` 来实现。
- 优点： 可以保证客户端始终获取到最新的资源。
- 缺点： 相比强缓存，会增加一次请求，稍微增加了一点网络开销。

#### 两者对比

| 特点                 | 强缓存                   | 协商缓存           |
| -------------------- | ------------------------ | ------------------ |
| 是否向服务器发送请求 | 不发送                   | 发送               |
| 控制方式             | Cache-Control: max-age   | Last-Modified/ETag |
| 优点                 | 减少服务器请求，提升速度 | 保证资源最新       |
| 缺点                 | 可能使用过期资源         | 增加一次请求       |

- 强缓存 更适合那些不经常变动的静态资源，比如图片、CSS、JS 文件等。
- 协商缓存 更适合那些经常变动的资源，比如数据接口返回的 JSON 数据。

#### 实际应用

在实际开发中，我们通常会结合强缓存和协商缓存来优化页面性能：

- 静态资源： 设置较长的 `max-age`，让浏览器长时间使用缓存。
- 动态资源： 使用 `Last-Modified` 或 `ETag` 来验证缓存是否有效。
- 特殊场景： 对于一些对实时性要求很高的资源，可以设置较短的 `max-age` 或不使用缓存。

#### 注意事项

- 浏览器缓存机制比较复杂，不同浏览器实现可能略有差异。
- 为了更好的控制缓存，可以借助一些构建工具（如 `Webpack`）来生成带哈希值的静态资源文件名，这样每次资源更新时，文件名也会改变，强制浏览器重新下载。

#### HTTP 缓存机制中的关键名词详细解释

##### 强缓存相关：

- max-age:
  - 作用： 指定缓存内容的最大有效期，单位为秒。
  - 位置： 响应头 `Cache-Control` 字段中。
  - 举例： `Cache-Control: max-age=3600 `表示缓存内容在 `1` 小时内有效。
  - 特点： 在 `max-age` 有效期内，浏览器直接从缓存中获取资源，不会向服务器发送请求。
- Expires:
  - 作用： 指定缓存过期的绝对时间。
  - 位置： 响应头中。
  - 特点： 功能与 `max-age` 相似，但 `max-age` 的优先级更高。由于服务器和客户端的时间可能不一致，`max-age` 比 `Expires` 更可靠。

#### 协商缓存相关：

- Last-Modified:
  - 作用： 表示资源在服务器上的最后修改时间。
  - 位置： 响应头中。
  - 特点： 服务器在响应中将资源的最后修改时间告诉浏览器，浏览器在下一次请求时，会将这个时间放在请求头 `If-Modified-Since` 中，服务器比较这两个时间，如果一致，则返回 `304 Not Modified`。
- If-Modified-Since:
  - 作用： 浏览器在请求中发送的字段，表示客户端所缓存的资源的最后修改时间。
  - 位置： 请求头中。
  - 特点： 服务器根据这个时间与服务器上资源的最后修改时间进行比较。
- ETag:
  - 作用： 一个唯一标识符，代表资源的一个版本。
  - 位置： 响应头中。
  - 特点： `ETag` 比 `Last-Modified` 更精确，因为它可以标识出那些内容虽然没有改变，但名称却改变了的文件。
  - If-None-Match: 对应 `ETag` 的请求头，浏览器在请求中发送，表示客户端缓存的资源的 `ETag`。

#### 总结

- 强缓存 主要通过 `max-age` 或 `Expires` 来控制缓存的有效期，在有效期内，浏览器直接使用缓存，无需向服务器发送请求。
- 协商缓存 主要通过 `Last-Modified/If-Modified-Since` 或 `ETag/If-None-Match` 来判断缓存是否过期。浏览器在请求时，将本地缓存的资源信息发送给服务器，服务器根据这些信息判断是否返回新的资源。
