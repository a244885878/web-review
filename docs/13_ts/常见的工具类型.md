# TypeScript çš„å¸¸ç”¨å·¥å…·ç±»å‹ï¼ˆUtility Typesï¼‰

TypeScript æä¾›äº†è®¸å¤šå®ç”¨çš„å·¥å…·ç±»å‹ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ åœ¨ä¸é‡å¤ç¼–å†™ç±»å‹å®šä¹‰çš„æƒ…å†µä¸‹çµæ´»åœ°æ„é€ æ–°çš„ç±»å‹ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„å·¥å…·ç±»å‹åŠå…¶ç”¨é€”ï¼š

## âœ… 1. `Partial<T>`

å°†ç±»å‹ T çš„æ‰€æœ‰å±æ€§å˜ä¸ºå¯é€‰ã€‚

```ts
type User = {
  name: string;
  age: number;
};

type PartialUser = Partial<User>;
// ç­‰ä»·äºï¼š{ name?: string; age?: number; }
```

## âœ… 2. `Required<T>`

å°†ç±»å‹ T çš„æ‰€æœ‰å±æ€§å˜ä¸ºå¿…é€‰ã€‚

```ts
type User = {
  name?: string;
  age?: number;
};

type RequiredUser = Required<User>;
// ç­‰ä»·äºï¼š{ name: string; age: number; }
```

## âœ… 3. `Readonly<T>`

å°†ç±»å‹ T çš„æ‰€æœ‰å±æ€§è®¾ä¸ºåªè¯»ã€‚

```ts
type User = {
  name: string;
  age: number;
};

type ReadonlyUser = Readonly<User>;
// name å’Œ age éƒ½ä¸èƒ½è¢«ä¿®æ”¹
```

## âœ… 4. `Record<K, T>`

æ„é€ ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œå±æ€§é”®æ˜¯ Kï¼Œå€¼æ˜¯ Tã€‚

```ts
type Role = "admin" | "user" | "guest";
type RoleMap = Record<Role, string>;
// ç­‰ä»·äºï¼š{ admin: string; user: string; guest: string }
```

## âœ… 5. `Pick<T, K>`

ä»ç±»å‹ T ä¸­é€‰å‡º K å±æ€§ç»„æˆæ–°çš„ç±»å‹ã€‚

```ts
type User = {
  name: string;
  age: number;
  email: string;
};

type UserNameAndAge = Pick<User, "name" | "age">;
// { name: string; age: number }
```

## âœ… 6. `Omit<T, K>`

ä»ç±»å‹ T ä¸­ç§»é™¤ K å±æ€§ç»„æˆæ–°çš„ç±»å‹ã€‚

```ts
type User = {
  name: string;
  age: number;
  email: string;
};

type UserWithoutEmail = Omit<User, "email">;
// { name: string; age: number }
```

## âœ… 7. `Exclude<T, U>`

ä»è”åˆç±»å‹ T ä¸­æ’é™¤æ‰ U ç±»å‹çš„æˆå‘˜ã€‚

```ts
type T = "a" | "b" | "c";
type Excluded = Exclude<T, "a">; // "b" | "c"
```

## âœ… 8. `Extract<T, U>`

ä» T ä¸­æå–å‡ºå¯ä»¥èµ‹å€¼ç»™ U çš„ç±»å‹æˆå‘˜ã€‚

```ts
type T = "a" | "b" | "c";
type OnlyB = Extract<T, "b" | "d">; // "b"
```

## âœ… 9. `NonNullable<T>`

æ’é™¤ null å’Œ undefinedã€‚

```ts
type T = string | null | undefined;
type NonNull = NonNullable<T>; // string
```

## âœ… 10. `ReturnType<T>`

è·å–å‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚

```ts
function getUser() {
  return { name: "Alice", age: 30 };
}

type User = ReturnType<typeof getUser>;
// { name: string; age: number }
```

## âœ… 11. `Parameters<T>`

è·å–å‡½æ•°çš„å‚æ•°ç±»å‹ç»„æˆçš„å…ƒç»„ç±»å‹ã€‚

```ts
function greet(name: string, age: number) {}

type Params = Parameters<typeof greet>;
// [name: string, age: number]
```

## âœ… 12. `ConstructorParameters<T>`

è·å–æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹ç»„æˆçš„å…ƒç»„ç±»å‹ã€‚

```ts
class Person {
  constructor(name: string, age: number) {}
}

type PersonArgs = ConstructorParameters<typeof Person>;
// [name: string, age: number]
```

## âœ… 13. `InstanceType<T>`

è·å–æ„é€ å‡½æ•°å®ä¾‹çš„ç±»å‹ã€‚

```ts
class Person {
  name = "Tom";
  age = 25;
}

type PersonInstance = InstanceType<typeof Person>;
// Person
```

## âœ… 14. `ThisType<T>`

ç”¨äºåœ¨å¯¹è±¡å­—é¢é‡ä¸­ä¸º `this` æŒ‡å®šç±»å‹ï¼ˆé…åˆ `object` ä½¿ç”¨ï¼‰ã€‚

```ts
type Helper = {
  message: string;
  log(): void;
} & ThisType<{ upper(): string }>;

const obj: Helper = {
  message: "hello",
  log() {
    console.log(this.upper()); // `this` æ¨æ–­ä¸º { upper(): string }
  },
  upper() {
    return this.message.toUpperCase();
  },
};
```

## ğŸ”§ æ·±åº¦å·¥å…·ç±»å‹æ‰©å±•

### âœ… `DeepPartial<T>`ï¼ˆé€’å½’åœ°å°†æ‰€æœ‰å±æ€§å˜ä¸ºå¯é€‰ï¼‰

```ts
type DeepPartial<T> = {
  [P in keyof T]?: T[P] extends object ? DeepPartial<T[P]> : T[P];
};

type Config = {
  db: {
    host: string;
    port: number;
  };
};

type PartialConfig = DeepPartial<Config>;
// {
//   db?: {
//     host?: string;
//     port?: number;
//   }
// }
```

### âœ… `DeepReadonly<T>`ï¼ˆé€’å½’åªè¯»ï¼‰

```ts
type DeepReadonly<T> = {
  readonly [P in keyof T]: T[P] extends object ? DeepReadonly<T[P]> : T[P];
};
```

### âœ… `Mutable<T>`ï¼ˆæŠŠ Readonly å˜æˆå¯ä¿®æ”¹ï¼‰

```ts
type Mutable<T> = {
  -readonly [P in keyof T]: T[P];
};
```

### âœ… `RequiredByKeys<T, K>`ï¼ˆåªå°†æŸå‡ ä¸ªå±æ€§è®¾ä¸ºå¿…å¡«ï¼‰

```ts
type RequiredByKeys<T, K extends keyof T> = Omit<T, K> & Required<Pick<T, K>>;
```

### âœ… `OmitByType<T, U>`ï¼ˆæ ¹æ®ç±»å‹ç§»é™¤å±æ€§ï¼‰

```ts
type OmitByType<T, U> = {
  [K in keyof T as T[K] extends U ? never : K]: T[K];
};

type Example = {
  id: number;
  name: string;
  callback: () => void;
};

type WithoutFunction = OmitByType<Example, Function>;
// => { id: number; name: string }
```

### âœ… `ExtractFunctionKeys<T>`ï¼ˆæå–å‡½æ•°ç±»å‹çš„é”®ï¼‰

```ts
type ExtractFunctionKeys<T> = {
  [K in keyof T]: T[K] extends Function ? K : never;
}[keyof T];
```

### âœ… `UnionToIntersection<U>`ï¼ˆè”åˆè½¬äº¤å‰ï¼‰

```ts
type UnionToIntersection<U> = (U extends any ? (x: U) => any : never) extends (
  x: infer I
) => any
  ? I
  : never;

type A = { a: string };
type B = { b: number };
type C = A | B;

type Result = UnionToIntersection<C>; // { a: string } & { b: number }
```

### âœ… `LastInUnion<U>`ï¼ˆæå–è”åˆç±»å‹ä¸­æœ€åä¸€ä¸ªæˆå‘˜ï¼‰

```ts
type LastInUnion<U> = UnionToIntersection<
  U extends any ? (x: U) => void : never
> extends (x: infer R) => void
  ? R
  : never;
```

### âœ… `IsAny<T>`ï¼ˆåˆ¤æ–­æ˜¯å¦ä¸º any ç±»å‹ï¼‰

```ts
type IsAny<T> = 0 extends 1 & T ? true : false;
```

## ğŸ§  å¸¸è§ç»„åˆæ„é€ æŠ€å·§

| ç›®çš„         | å·¥å…·ç»„åˆ                  |
| ------------ | ------------------------- |
| é€’å½’å˜æ›´å±æ€§ | `Mapped Type` + `extends` |
| æ¡ä»¶ç±»å‹åˆ¤æ–­ | `T extends U ? A : B`     |
| æ¨æ–­ç±»å‹     | `infer`                   |
| æ“ä½œé”®å     | `keyof` + `as`            |
| ç§»é™¤å±æ€§     | `Omit` + æ˜ å°„             |

## ğŸš€ å®ç”¨ç¬¬ä¸‰æ–¹ç±»å‹åº“æ¨è

| åç§°                                                           | ç”¨é€”                                                     |
| -------------------------------------------------------------- | -------------------------------------------------------- |
| [`type-fest`](https://github.com/sindresorhus/type-fest)       | é«˜çº§ TS ç±»å‹é›†åˆï¼ˆå¾ˆå¤šä¸Šé¢æåˆ°çš„å·¥å…·ç±»å‹éƒ½å¯ä»¥åœ¨è¿™æ‰¾åˆ°ï¼‰ |
| [`utility-types`](https://github.com/piotrwitek/utility-types) | æ›´æ—©æœŸçš„ä¸€äº›å®ç”¨å·¥å…·ç±»å‹é›†åˆ                             |
| [`ts-toolbelt`](https://github.com/millsp/ts-toolbelt)         | å¼ºå¤§è€Œå…¨é¢çš„ç±»å‹è¿ç®—åº“ï¼Œé€‚åˆåšå¤æ‚ç±»å‹ç¼–ç¨‹               |
