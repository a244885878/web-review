### 浏览器渲染一个网页的过程大致如下：

1. 解析 HTML: 构建 DOM 树。遇到`<img>`标签时，会发送请求加载图片。
2. 解析 CSS: 构建 CSSOM 树。
3. 结合 DOM 和 CSSOM: 构建渲染树。
4. 布局: 计算每个节点的几何信息。
5. 绘制: 将渲染树绘制到屏幕上。

> 图片的加载和渲染通常发生在第 3 步和第 5 步之间。 也就是说，浏览器在构建渲染树时会加载对应的图片资源，然后在绘制阶段将图片渲染到页面上。

#### 影响图片加载与渲染的因素

- HTML 结构: `<img>`标签的位置、display 属性、visibility 属性等都会影响图片的加载和渲染时机。
- CSS 样式: `background-image`、`object-fit`等属性会影响图片的显示方式。
- JavaScript 代码: JavaScript 代码可以通过 DOM 操作来控制图片的加载和显示。
- 浏览器缓存: 浏览器会缓存图片，减少重复加载。
- 网络状况: 网络速度会影响图片的加载时间。

#### 图片加载与渲染的优化

- 懒加载: 只有当图片进入视口或即将进入视口时才加载，可以提高页面加载速度。
- 图片压缩: 降低图片质量，减少文件大小。
- 使用 webp 格式: webp 格式的图片压缩比更高。
- CSS sprites: 将多个小图标合并成一张图片，减少 HTTP 请求。
- iconfont: 使用字体图标，减少 HTTP 请求。
- 响应式图片: 根据屏幕大小加载不同尺寸的图片。

##### 图片加载的特点

- display:none 的元素: 设置了`display:none`的元素，其内部的图片不会渲染，但会加载。
- JavaScript 动态加载图片: 通过 JavaScript 动态创建的图片元素，其加载时机由 JavaScript 代码控制。
- 页面中多个`<img>`标签或样式表中的背景图片图片路径是同一个，图片只加载一次（浏览器请求资源时，都会先判断是否有缓存，若有缓存且未过期则会从缓存中读取，不会再次请求。先加载的图片会存储到浏览器缓存中，后面再次请求同路径图片时会直接读取缓存中的图片。）
- 不存在元素的背景图片不会加载（不存在的元素不会产出到 DOM 树上，构建渲染树过程中遍历 DOM 树时无法遍历不存在的元素，因此不会加载图片，也不会产出到渲染树上。当解析渲染树时无法解析不存在的元素，不存在的元素自然也不会渲染。）
- 当触发伪类的时候，伪类样式上的背景图片才会加载。

##### 总结

图片的加载和渲染是网页性能优化中非常重要的一环。通过了解图片加载的原理和优化方法，可以有效提高网页的加载速度和用户体验。
