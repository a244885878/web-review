#### TCP 三次握手

三次握手是 TCP 协议建立连接的过程，确保双方都准备好进行通信。

1. 第一次握手（SYN）：
   1. 客户端发送一个 SYN (synchronize) 包到服务器，请求建立连接。
   2. 这个包中包含客户端的初始序列号 (sequence number)。
2. 第二次握手（SYN-ACK）：
   1. 服务器收到 SYN 包后，会发送一个 SYN-ACK (synchronize-acknowledgment) 包作为回应。
   2. 这个包中包含服务器的初始序列号，以及对客户端序列号的确认 (acknowledgment number)。
3. 第三次握手（ACK）：
   1. 客户端收到 SYN-ACK 包后，会发送一个 ACK (acknowledgment) 包。
   2. 这个包包含对服务器序列号的确认。

完成这三次握手后，客户端和服务器就都进入了 ESTABLISHED 状态，可以开始进行数据传输。

##### 三次握手的作用

- 确认双方的接收和发送能力： 双方通过交换 SYN 和 SYN-ACK 包，可以确认彼此的接收和发送能力都正常。
- 同步序列号： 三次握手可以确保双方的初始序列号是同步的，这对于后续的数据传输和确认非常重要。
- 防止旧的连接请求： 三次握手可以防止旧的、失效的连接请求重新出现，避免服务器资源的浪费。

##### TCP 四次挥手

四次挥手是 TCP 协议断开连接的过程，确保双方都正常结束通信。

1. 第一次挥手（FIN）：
   1. 客户端发送一个 FIN (finish) 包，表示客户端没有数据要发送了，请求关闭连接。
2. 第二次挥手（ACK）：
   1. 服务器收到 FIN 包后，会发送一个 ACK 包作为回应，表示知道了客户端的关闭请求。
   2. 但服务器可能还有数据要发送，所以此时连接并没有完全关闭。
3. 第三次挥手（FIN）：
   1. 服务器发送完所有数据后，会发送一个 FIN 包，表示服务器也没有数据要发送了，请求关闭连接。
4. 第四次挥手（ACK）：
   1. 客户端收到 FIN 包后，会发送一个 ACK 包作为回应，表示同意关闭连接。

完成这四次挥手后，客户端和服务器就都进入了 CLOSED 状态，连接完全断开。

##### 四次挥手的作用

- 确保双方都完成数据传输： 四次挥手可以确保双方都完成了数据的发送和接收，避免数据丢失。
- 正常关闭连接： 四次挥手可以确保连接正常关闭，释放双方的资源。

#### 总结

TCP 三次握手和四次挥手是 TCP 协议中非常重要的两个过程，它们保证了连接的可靠性和数据的完整性。理解这两个过程对于理解 TCP 协议的工作原理非常有帮助。
