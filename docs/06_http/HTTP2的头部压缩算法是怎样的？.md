> HTTP/2 头部压缩算法是 HPACK（HTTP/2 Header Compression），它是一种专门为 HTTP/2 设计的头部压缩机制。与 HTTP/1.x 使用的通用压缩算法（如 gzip 或 deflate）不同，HPACK 针对 HTTP 头部字段的特点进行了优化，旨在更有效地减少头部数据的大小，从而提高网络传输效率。

#### HPACK 的主要目标和特点：

- 减少头部大小： 通过高效的压缩算法，显著减少 HTTP 头部信息在网络传输中占用的带宽。
- 提高头部重用性： 利用静态表和动态表，存储和索引常见的头部字段和值，避免重复传输相同的数据。
- 保持简单性和灵活性： 设计简单，易于实现，同时能够适应各种不同的头部字段组合。

#### HPACK 的核心机制：

- 静态表（Static Table）：
  - HPACK 预定义了一个包含常见头部字段名称和值的静态表。例如，`:method: GET、:status: 200、content-type: text/html` 等。
  - 发送方和接收方都预先知道这张表，因此只需传输索引值即可表示这些常见的头部字段，无需传输完整的字符串。
- 动态表（Dynamic Table）：
  - 动态表是一个先进先出（FIFO）的队列，用于存储在通信过程中新出现的头部字段和值。
  - 当客户端或服务器发送新的头部字段时，会将其添加到动态表中，并分配一个索引值。
  - 后续传输中，可以直接使用动态表中的索引值来表示这些头部字段，从而减少数据传输量。
- 索引表示法：
  - HPACK 使用索引表示法来引用静态表和动态表中的条目。
  - 当头部字段存在于静态表或动态表中时，只需传输对应的索引值即可。
- 字面量表示法：
  - 对于未在静态表或动态表中出现的头部字段，HPACK 使用字面量表示法。
  - 字面量表示法会将头部字段的名称和值进行编码后传输。
  - HPACK 还支持使用 Huffman 编码对字面量进行压缩，进一步减少数据大小。
- 编码方式：
  - 整数编码： HPACK 使用一种变长整数编码方式，可以有效地表示较小的整数值，同时也能扩展到表示较大的整数值。
  - 字符串编码： HPACK 使用前缀长度编码和可选的 Huffman 编码来表示字符串。

#### HPACK 的工作流程：

1. 发送方检查要发送的头部字段是否在静态表中。如果在，则使用静态表中的索引值。
2. 如果不在静态表中，则检查是否在动态表中。如果在，则使用动态表中的索引值。
3. 如果都不在，则使用字面量表示法对头部字段进行编码，并可以选择将其添加到动态表中。
4. 接收方根据接收到的索引值或字面量解码头部字段。
5. 接收方根据需要更新动态表。

#### HPACK 的优点：

- 显著减少头部大小，提高网络传输效率。
- 有效利用头部字段的重复性，减少冗余数据传输。
- 简单易实现，降低了开发和部署成本。

#### HPACK 的局限性：

- HPACK 依赖于客户端和服务器之间维护的状态（静态表和动态表），这可能导致一些安全问题，例如头部压缩的上下文注入攻击（Head Compression Context Injection）。
- 动态表的大小是有限的，当动态表填满时，需要进行替换操作，这可能会影响压缩效率。

总而言之，HPACK 是 HTTP/2 中一项重要的改进，它通过高效的头部压缩算法，显著提高了 Web 应用程序的性能。
