执行上下文 (Execution Context) 和 执行栈 (Execution Stack) 是 JavaScript 执行机制的核心概念，帮助理解代码的执行过程。

#### 1. 执行上下文 (Execution Context)

> 执行上下文是 JavaScript 代码在执行时的环境。它包含了关于代码如何执行的信息。每当 JavaScript 代码被执行时，都会创建一个执行上下文，执行上下文管理着代码的执行顺序和生命周期。执行上下文分为三种类型：

- 全局执行上下文 (Global Execution Context): 这是最初的执行上下文，所有代码最先执行的地方。它是代码最外层的环境，并且全局作用域的 `this` 指向全局对象（在浏览器中是 `window`）。
- 函数执行上下文 (Function Execution Context): 每当调用一个函数时，都会为该函数创建一个新的执行上下文。它包括函数的作用域、函数的参数以及函数内部的 `this`。
- Eval 执行上下文 (Eval Execution Context): 执行 `eval()` 函数时创建的执行上下文，虽然在现代 `JavaScript` 中不推荐使用。

##### 每个执行上下文都会有两个重要的组成部分：

- 变量环境 (Variable Environment): 用于存储变量、函数声明等的环境。
- 词法环境 (Lexical Environment): 包含了当前上下文的变量和函数声明，实际上是通过作用域链来查找变量的机制。

#### 2. 执行栈 (Execution Stack)

> 执行栈是 JavaScript 引擎用来管理执行上下文的栈结构。栈是一个后进先出（LIFO，Last In First Out）的数据结构。当一个执行上下文被创建时，它会被推入栈中，执行完后会从栈中弹出。

执行栈的工作过程：

1. 执行时，首先会创建一个 全局执行上下文 并将其推入栈中。
2. 当函数被调用时，JavaScript 会为该函数创建一个新的 函数执行上下文 并将其推入栈中。
3. 函数执行完毕后，该函数的执行上下文会从栈中弹出，控制流返回到上一个执行上下文。

#### 执行上下文的创建过程：

- 创建阶段：在创建执行上下文时，JavaScript 引擎会创建：
  - 全局环境：初始化全局对象（如 window）和 this。
  - 函数环境：为函数的参数和声明创建变量。
- 执行阶段：此阶段开始实际执行代码，按顺序执行所有代码。

#### 执行上下文和执行栈的关系：

> 执行栈中的上下文依次推进和弹出。每当一个函数被调用时，它的上下文就会推入栈中；当函数执行完毕，栈会弹出，控制权返回到之前的执行上下文。

```js
function first() {
  console.log("First");
  second();
}

function second() {
  console.log("Second");
}

first();
```

##### 执行过程：

1. 全局执行上下文 被推入栈中。
2. 调用 `first()` 函数时，first 执行上下文 被推入栈中，执行 `console.log("First")`。
3. 调用 `second()` 函数时，second 执行上下文 被推入栈中，执行 `console.log("Second")`。
4. `second()` 执行完毕，second 执行上下文 被弹出。
5. `first()` 执行完毕，first 执行上下文 被弹出。
6. 最后，全局执行上下文 被弹出，程序结束。

#### 总结

- 执行上下文是代码执行的环境，包含了变量、函数等信息。
- 执行栈用于管理执行上下文，确保按照正确的顺序执行代码。
- 执行上下文的栈结构帮助实现了 JavaScript 的异步和函数调用机制。
